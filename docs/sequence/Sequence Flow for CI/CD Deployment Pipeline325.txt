# 1 Overview

## 1.1 Diagram Id

SEQ-OPS-001

## 1.2 Name

CI/CD Deployment Pipeline

## 1.3 Description

A developer pushes code to the Git repository, which automatically triggers a GitHub Actions pipeline. The pipeline lints, tests, runs security scans (SAST, SCA, container), builds artifacts, pushes to ECR, runs database migrations, and deploys the new version to AWS using Terraform, employing a Blue/Green strategy.

## 1.4 Type

üîπ OperationalFlow

## 1.5 Purpose

To automate the software release process, ensuring code quality, security, and consistent, repeatable deployments with minimal downtime, as per REQ-DEV-001 and REQ-TRN-001.

## 1.6 Complexity

High

## 1.7 Priority

üö® Critical

## 1.8 Frequency

OnDemand

## 1.9 Participants

- REPO-GIT-GITHUB
- REPO-CI-CD-GHACTIONS
- REPO-CONTAINER-REGISTRY-ECR
- REPO-IAC-TERRAFORM
- REPO-AWS-ENVIRONMENT

## 1.10 Key Interactions

- Developer pushes code to a feature branch in GitHub and opens a Pull Request.
- A GitHub Actions workflow is triggered to run linting, unit tests, and security scans (SAST, SCA).
- Upon merge to the main branch, the deployment workflow triggers.
- The backend service is built into a Docker image, scanned for vulnerabilities, and pushed to Amazon ECR.
- Frontend assets are built and prepared for deployment.
- The pipeline executes database migrations via a dedicated, version-controlled script runner.
- The pipeline runs `terraform apply` to provision the 'Green' environment with the new version.
- After health checks pass on the 'Green' environment, traffic is switched from 'Blue' to 'Green'.

## 1.11 Triggers

- A git push/merge event to the main branch in the source code repository.

## 1.12 Outcomes

- A new, tested, and secure version of the application is deployed to production with zero downtime.
- The database schema is updated to be compatible with the new code.

## 1.13 Business Rules

- The pipeline must fail and stop the deployment if any test or security scan fails.
- Database migrations must run before the application deployment.

## 1.14 Error Scenarios

- Unit tests fail.
- A critical vulnerability is found in a dependency.
- Database migration fails, preventing deployment.
- The 'Green' environment fails health checks, preventing the traffic switch and enabling easy rollback.

## 1.15 Integration Points

- GitHub, GitHub Actions, Amazon ECR, Terraform.

# 2.0 Details

## 2.1 Diagram Id

SEQ-OPS-001-IMPL

## 2.2 Name

CI/CD Deployment Pipeline for Blue/Green Deployment

## 2.3 Description

Technical sequence for a GitOps-driven CI/CD pipeline using GitHub Actions and Terraform. A code push triggers a workflow that validates, tests, scans, and builds application artifacts. It then executes database migrations and uses Terraform to deploy a new 'Green' environment on AWS. Upon successful health checks, traffic is switched from the 'Blue' environment, ensuring a zero-downtime release as per REQ-DEV-001 and REQ-TRN-001.

## 2.4 Participants

### 2.4.1 Human Actor

#### 2.4.1.1 Repository Id

ACTOR-DEVELOPER

#### 2.4.1.2 Display Name

Developer

#### 2.4.1.3 Type

üîπ Human Actor

#### 2.4.1.4 Technology

Git CLI

#### 2.4.1.5 Order

1

#### 2.4.1.6 Style

| Property | Value |
|----------|-------|
| Shape | actor |
| Color | #999999 |
| Stereotype | User |

### 2.4.2.0 VCS

#### 2.4.2.1 Repository Id

REPO-GIT-GITHUB

#### 2.4.2.2 Display Name

GitHub Repository

#### 2.4.2.3 Type

üîπ VCS

#### 2.4.2.4 Technology

Git, GitHub Webhooks

#### 2.4.2.5 Order

2

#### 2.4.2.6 Style

| Property | Value |
|----------|-------|
| Shape | participant |
| Color | #181717 |
| Stereotype | Version Control |

### 2.4.3.0 CI/CD Orchestrator

#### 2.4.3.1 Repository Id

REPO-CI-CD-GHACTIONS

#### 2.4.3.2 Display Name

GitHub Actions

#### 2.4.3.3 Type

üîπ CI/CD Orchestrator

#### 2.4.3.4 Technology

GitHub Actions Runner (Ubuntu)

#### 2.4.3.5 Order

3

#### 2.4.3.6 Style

| Property | Value |
|----------|-------|
| Shape | participant |
| Color | #2088FF |
| Stereotype | Orchestrator |

### 2.4.4.0 Container Registry

#### 2.4.4.1 Repository Id

REPO-CONTAINER-REGISTRY-ECR

#### 2.4.4.2 Display Name

Amazon ECR

#### 2.4.4.3 Type

üîπ Container Registry

#### 2.4.4.4 Technology

AWS ECR Service

#### 2.4.4.5 Order

4

#### 2.4.4.6 Style

| Property | Value |
|----------|-------|
| Shape | participant |
| Color | #FF9900 |
| Stereotype | Registry |

### 2.4.5.0 IaC Tool

#### 2.4.5.1 Repository Id

REPO-IAC-TERRAFORM

#### 2.4.5.2 Display Name

Terraform

#### 2.4.5.3 Type

üîπ IaC Tool

#### 2.4.5.4 Technology

Terraform CLI v1.8.x

#### 2.4.5.5 Order

5

#### 2.4.5.6 Style

| Property | Value |
|----------|-------|
| Shape | participant |
| Color | #7B42BC |
| Stereotype | IaC |

### 2.4.6.0 Cloud Platform

#### 2.4.6.1 Repository Id

REPO-AWS-ENVIRONMENT

#### 2.4.6.2 Display Name

AWS Environment

#### 2.4.6.3 Type

üîπ Cloud Platform

#### 2.4.6.4 Technology

AWS (ECS, RDS, ALB, Route53)

#### 2.4.6.5 Order

6

#### 2.4.6.6 Style

| Property | Value |
|----------|-------|
| Shape | participant |
| Color | #232F3E |
| Stereotype | Cloud Environment |

## 2.5.0.0 Interactions

### 2.5.1.0 Request

#### 2.5.1.1 Source Id

ACTOR-DEVELOPER

#### 2.5.1.2 Target Id

REPO-GIT-GITHUB

#### 2.5.1.3 Message

1. Push code to main branch

#### 2.5.1.4 Sequence Number

1

#### 2.5.1.5 Type

üîπ Request

#### 2.5.1.6 Is Synchronous

‚úÖ Yes

#### 2.5.1.7 Return Message

Success confirmation

#### 2.5.1.8 Has Return

‚úÖ Yes

#### 2.5.1.9 Is Activation

‚ùå No

#### 2.5.1.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | Git over SSH/HTTPS |
| Method | git push origin main |
| Parameters | Commits, code changes |
| Authentication | SSH Key or PAT |
| Error Handling | Git client handles connection errors or merge conf... |
| Performance | Dependent on network and commit size. |

### 2.5.2.0 Webhook

#### 2.5.2.1 Source Id

REPO-GIT-GITHUB

#### 2.5.2.2 Target Id

REPO-CI-CD-GHACTIONS

#### 2.5.2.3 Message

2. Trigger 'on push' workflow

#### 2.5.2.4 Sequence Number

2

#### 2.5.2.5 Type

üîπ Webhook

#### 2.5.2.6 Is Synchronous

‚ùå No

#### 2.5.2.7 Return Message



#### 2.5.2.8 Has Return

‚ùå No

#### 2.5.2.9 Is Activation

‚úÖ Yes

#### 2.5.2.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | HTTPS |
| Method | POST |
| Parameters | Webhook payload with git ref, commit SHA, reposito... |
| Authentication | N/A (Internal GitHub event bus) |
| Error Handling | GitHub platform manages webhook delivery reliabili... |
| Performance | Sub-second trigger latency. |

### 2.5.3.0 Self-Call

#### 2.5.3.1 Source Id

REPO-CI-CD-GHACTIONS

#### 2.5.3.2 Target Id

REPO-CI-CD-GHACTIONS

#### 2.5.3.3 Message

3. Run CI Stage: Lint, Test, Security Scans

#### 2.5.3.4 Sequence Number

3

#### 2.5.3.5 Type

üîπ Self-Call

#### 2.5.3.6 Is Synchronous

‚úÖ Yes

#### 2.5.3.7 Return Message

CI Stage Status (Success/Failure)

#### 2.5.3.8 Has Return

‚úÖ Yes

#### 2.5.3.9 Is Activation

‚ùå No

#### 2.5.3.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | Shell |
| Method | Execute workflow steps (e.g., `npm ci`, `npm run l... |
| Parameters | Code from checked-out repository. |
| Authentication | GitHub Actions Runner token (`secrets.GITHUB_TOKEN... |
| Error Handling | Job fails immediately if any step returns a non-ze... |
| Performance | Cached dependencies (npm modules) to reduce execut... |

#### 2.5.3.11 Nested Interactions

*No items available*

### 2.5.4.0 Self-Call

#### 2.5.4.1 Source Id

REPO-CI-CD-GHACTIONS

#### 2.5.4.2 Target Id

REPO-CI-CD-GHACTIONS

#### 2.5.4.3 Message

4. Build & Scan Docker Image

#### 2.5.4.4 Sequence Number

4

#### 2.5.4.5 Type

üîπ Self-Call

#### 2.5.4.6 Is Synchronous

‚úÖ Yes

#### 2.5.4.7 Return Message

Docker Image with Tag

#### 2.5.4.8 Has Return

‚úÖ Yes

#### 2.5.4.9 Is Activation

‚ùå No

#### 2.5.4.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | Shell/Docker CLI |
| Method | `docker build -t <image>:<tag>` followed by contai... |
| Parameters | Dockerfile, application source code. |
| Authentication | N/A |
| Error Handling | Job fails if `docker build` fails or if vulnerabil... |
| Performance | Leverage Docker layer caching to accelerate builds... |

### 2.5.5.0 Request

#### 2.5.5.1 Source Id

REPO-CI-CD-GHACTIONS

#### 2.5.5.2 Target Id

REPO-CONTAINER-REGISTRY-ECR

#### 2.5.5.3 Message

5. Authenticate and Push Image to ECR

#### 2.5.5.4 Sequence Number

5

#### 2.5.5.5 Type

üîπ Request

#### 2.5.5.6 Is Synchronous

‚úÖ Yes

#### 2.5.5.7 Return Message

Push confirmation

#### 2.5.5.8 Has Return

‚úÖ Yes

#### 2.5.5.9 Is Activation

‚ùå No

#### 2.5.5.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | AWS CLI/Docker CLI |
| Method | `aws ecr get-login-password` \| `docker login`, th... |
| Parameters | Docker image layers, repository URI. |
| Authentication | AWS IAM Role for GitHub Actions (OIDC). Role must ... |
| Error Handling | Retry logic for transient network errors. Job fail... |
| Performance | Dependent on image size and network bandwidth. |

### 2.5.6.0 Request

#### 2.5.6.1 Source Id

REPO-CI-CD-GHACTIONS

#### 2.5.6.2 Target Id

REPO-AWS-ENVIRONMENT

#### 2.5.6.3 Message

6. Run Database Migrations

#### 2.5.6.4 Sequence Number

6

#### 2.5.6.5 Type

üîπ Request

#### 2.5.6.6 Is Synchronous

‚úÖ Yes

#### 2.5.6.7 Return Message

Migration status

#### 2.5.6.8 Has Return

‚úÖ Yes

#### 2.5.6.9 Is Activation

‚ùå No

#### 2.5.6.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | TCP/SQL |
| Method | Execute migration script (e.g., `npm run typeorm:m... |
| Parameters | Database connection string (from AWS Secrets Manag... |
| Authentication | Database credentials retrieved via IAM role from A... |
| Error Handling | Critical failure point. Job fails immediately if m... |
| Performance | Depends on the complexity and number of migration ... |

### 2.5.7.0 Request

#### 2.5.7.1 Source Id

REPO-CI-CD-GHACTIONS

#### 2.5.7.2 Target Id

REPO-IAC-TERRAFORM

#### 2.5.7.3 Message

7. Apply Terraform for 'Green' Environment

#### 2.5.7.4 Sequence Number

7

#### 2.5.7.5 Type

üîπ Request

#### 2.5.7.6 Is Synchronous

‚úÖ Yes

#### 2.5.7.7 Return Message

Terraform apply result

#### 2.5.7.8 Has Return

‚úÖ Yes

#### 2.5.7.9 Is Activation

‚úÖ Yes

#### 2.5.7.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | Terraform CLI |
| Method | `terraform apply -auto-approve -var 'image_tag=<ne... |
| Parameters | Terraform configuration files, new image tag, targ... |
| Authentication | AWS IAM Role for GitHub Actions (OIDC) with permis... |
| Error Handling | Job fails if `terraform apply` returns an error. T... |
| Performance | Deployment time is dependent on the number and typ... |

### 2.5.8.0 API Call

#### 2.5.8.1 Source Id

REPO-IAC-TERRAFORM

#### 2.5.8.2 Target Id

REPO-AWS-ENVIRONMENT

#### 2.5.8.3 Message

8. Provision/Update 'Green' ECS Service

#### 2.5.8.4 Sequence Number

8

#### 2.5.8.5 Type

üîπ API Call

#### 2.5.8.6 Is Synchronous

‚úÖ Yes

#### 2.5.8.7 Return Message

Resource ARNs and status

#### 2.5.8.8 Has Return

‚úÖ Yes

#### 2.5.8.9 Is Activation

‚ùå No

#### 2.5.8.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | AWS API |
| Method | e.g., `ecs:CreateService`, `ecs:UpdateService`, `e... |
| Parameters | Resource definitions from HCL code. |
| Authentication | Inherits IAM Role from GHActions runner. |
| Error Handling | Errors are caught by Terraform and bubble up to th... |
| Performance | N/A |

### 2.5.9.0 Request

#### 2.5.9.1 Source Id

REPO-CI-CD-GHACTIONS

#### 2.5.9.2 Target Id

REPO-AWS-ENVIRONMENT

#### 2.5.9.3 Message

9. Perform Health Checks on 'Green' Environment

#### 2.5.9.4 Sequence Number

9

#### 2.5.9.5 Type

üîπ Request

#### 2.5.9.6 Is Synchronous

‚úÖ Yes

#### 2.5.9.7 Return Message

Health status (200 OK / non-200)

#### 2.5.9.8 Has Return

‚úÖ Yes

#### 2.5.9.9 Is Activation

‚ùå No

#### 2.5.9.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | HTTP/S |
| Method | GET |
| Parameters | Health check endpoint URL of the 'Green' service (... |
| Authentication | N/A for public health check endpoints. |
| Error Handling | Script will poll the endpoint with a timeout. If a... |
| Performance | Should respond in < 200ms. |

### 2.5.10.0 Request

#### 2.5.10.1 Source Id

REPO-CI-CD-GHACTIONS

#### 2.5.10.2 Target Id

REPO-AWS-ENVIRONMENT

#### 2.5.10.3 Message

10. Switch Production Traffic to 'Green'

#### 2.5.10.4 Sequence Number

10

#### 2.5.10.5 Type

üîπ Request

#### 2.5.10.6 Is Synchronous

‚úÖ Yes

#### 2.5.10.7 Return Message

Traffic switch confirmation

#### 2.5.10.8 Has Return

‚úÖ Yes

#### 2.5.10.9 Is Activation

‚ùå No

#### 2.5.10.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | AWS API/CLI |
| Method | Update ALB listener rules, or update Route53 CNAME... |
| Parameters | ALB listener ARN, Target Group ARN for 'Green' env... |
| Authentication | AWS IAM Role with permissions for `elbv2:ModifyLis... |
| Error Handling | Failure at this stage is critical and may require ... |
| Performance | Traffic switch should be near-instantaneous. |

### 2.5.11.0 API Call

#### 2.5.11.1 Source Id

REPO-CI-CD-GHACTIONS

#### 2.5.11.2 Target Id

REPO-GIT-GITHUB

#### 2.5.11.3 Message

11. Update Commit Status to 'Success'

#### 2.5.11.4 Sequence Number

11

#### 2.5.11.5 Type

üîπ API Call

#### 2.5.11.6 Is Synchronous

‚úÖ Yes

#### 2.5.11.7 Return Message

API response

#### 2.5.11.8 Has Return

‚úÖ Yes

#### 2.5.11.9 Is Activation

‚ùå No

#### 2.5.11.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | HTTPS |
| Method | POST to GitHub Checks API |
| Parameters | Commit SHA, status, description, target URL. |
| Authentication | `secrets.GITHUB_TOKEN` |
| Error Handling | Non-critical if this fails; the deployment is alre... |
| Performance | Sub-second. |

## 2.6.0.0 Notes

### 2.6.1.0 Content

#### 2.6.1.1 Content

A separate, scheduled workflow should be considered to decommission the old 'Blue' environment after a configurable confidence period (e.g., 24 hours) to allow for quick rollback if post-deployment issues are found.

#### 2.6.1.2 Position

bottom

#### 2.6.1.3 Participant Id

*Not specified*

#### 2.6.1.4 Sequence Number

11

### 2.6.2.0 Content

#### 2.6.2.1 Content

All sensitive data (AWS credentials, DB connection strings) must be stored in GitHub Encrypted Secrets and accessed as environment variables in the workflow, never hardcoded.

#### 2.6.2.2 Position

top

#### 2.6.2.3 Participant Id

REPO-CI-CD-GHACTIONS

#### 2.6.2.4 Sequence Number

2

### 2.6.3.0 Content

#### 2.6.3.1 Content

The 'Green' environment health check can be a simple endpoint check or a more comprehensive suite of automated E2E tests (e.g., using Cypress) run against the new deployment.

#### 2.6.3.2 Position

right

#### 2.6.3.3 Participant Id

REPO-AWS-ENVIRONMENT

#### 2.6.3.4 Sequence Number

9

## 2.7.0.0 Implementation Guidance

| Property | Value |
|----------|-------|
| Security Requirements | The GitHub Actions runner must be configured with ... |
| Performance Targets | Total pipeline execution time (push to live traffi... |
| Error Handling Strategy | The pipeline is designed to be fail-fast. A failur... |
| Testing Considerations | The CI stage must have comprehensive unit and inte... |
| Monitoring Requirements | The GitHub Actions UI provides real-time logging f... |
| Deployment Considerations | This pipeline must use Terraform workspaces to man... |

